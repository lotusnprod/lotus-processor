# OpenNPDB: an Open Natural Products Database

*OpenNPDB:* an Open Natural Products Database. Actually, this database (DB) consists of XXX'XXX structure - organism pairs, gathered and standardized among XX open DB’s. It represents the most exhaustive open DB for natural products (NP’s) dereplication. It encompasses XXX'XXX distinct structures in XX’XXX resolved taxa. Additionally, both chemical and biological resolved taxonomies are given for each chemical and biological taxon, respectively. Other basic chemical descriptors and in silico tandem mass spectrometry (MS/MS) spectrum are provided for each structure. Within the frame of current computational approaches to guide NP’s research, all these elements should allow a more complete understanding of organisms and their metabolites.

![Graphical abstract](outputs/figures/graphical_abstract.png)

<object data="https://gitlab.unige.ch/Adriano.Rutz/opennaturalproductsdb/-/blob/e47e42bb1335d381373ce65aa61a508f25e811c4/outputs/figures/graphical_abstract.pdf" type="application/pdf" width="1920px" height="1080px">
    <embed src="https://gitlab.unige.ch/Adriano.Rutz/opennaturalproductsdb/-/blob/e47e42bb1335d381373ce65aa61a508f25e811c4/outputs/figures/graphical_abstract.pdf">
        <p>This browser does not support PDFs. Please download the PDF to view it: <a href="https://gitlab.unige.ch/Adriano.Rutz/opennaturalproductsdb/-/blob/e47e42bb1335d381373ce65aa61a508f25e811c4/outputs/figures/graphical_abstract.pdf">Download PDF</a>.</p>
    </embed>
</object>

## Getting Started

These instructions will get you a copy of the project up and running on your local machine for development and testing purposes. ...

### Prerequisites

- R (ideally with RStudio (https://rstudio.com))
- Anaconda distribution (https://www.anaconda.com/distribution/) with RDKit installed (https://www.rdkit.org/docs/Install.html)
- GNFinder command line app (https://github.com/gnames/gnfinder/releases)
- ClassyFire API (https://bitbucket.org/wishartlab/classyfire_api/) ## see if necessary after PM's script 

```
Give examples

Test on a Windows and Linux machine

(@pma now testing on x2go (debian system))
```

### Packages

#### Conda environement

A "loose" environment_loose.yml file is created and should allow to recreate a working env formthe project without beeing too restrictive on the versions to install.
Install it by running in the home directory. Else use the environment_notloose.yml for strict mirroring of the installed packages.

````
conda env create -f environment_loose.yml

````


If your environement is not directly sources by your default bash run the following lines

````
$ source ~/anaconda3/etc/profile.d/conda.sh

$ conda activate your_env
````

If you are using Visual Studio be sure to set your R path in the settings option to reflect your created conda environment.

#### R
```
R: to do 
```

#### Python
```
Python dependencies (RdKit): to do 
Use pip freeze or conda export

maybe use https://pypi.org/project/pipreqs/ instead
```

#### Ruby (if still used after PMA script)
```
Ruby: to do (https://rubygems.org/gems/rest-client/versions/1.8.0?locale=fr)
```

## Minimal working example

A minimal working example containing XXX entries coming from various DB's is proposed.
Use this example to check if all steps are running correctly on your machine.

### Description

The minimal working example file contains following columns:

TO DO

```
Give an example
```

### Final output

If everything went well, the output of the minimal working example should be:

TO DO

```
Give an example 
```

## Content 

### 00_miscellanous (folder)
#### files
- *common_names_list*: list of common names and their scientific translation generated by *00_translate_common*.
- *tcm_names_list*: list of tcm names and their scientific translation generated by *00_translate_TCM*.

#### folders
- *TCM_Dictionary*: contains inputs needed by *00_translate_TCM*.
- *TCMID*: contains inputs needed by *00_translate_TCM*.

#### scripts
- *00_adduct_DB_curated*: generates in source MS adducts from molecular formula of each structure for dereplication purposes.
- *00_translate_common*: compiles a list (*common_names_list*) of common names and their scientific translation.
- *00_translate_TCM*: compiles a list (*TCM_names_list*) of TCM names and their scientific translation.

### 01_databases (folder)
Single folders containing original entries of each sub-DB present in OpenNPDB, related scripts and generated standardized minimal adequate information. All folders are built the same way:
- (*optional*) A script to retrieve entries when not directly accessible
- A folder containing the original files retrieved for each database
- A cleaning script to perform data manipulation and get a *standardized table* containing minimal adequate information for each DB.
- The *standardized table* containing minimal adequate information for each DB.

### 01_compile_DB_original (script)
Takes all *standardized tables* in *01_databases* as input and generates outputs in *outputs/tables/0_original*.
- If structural field (InChI or SMILES) present, takes it and writes it as a list in *outputs/tables/0_original*. 
	- If InChI present, takes it and writes it as *original_structure_inchi.tsv*.
	- If SMILES present, takes it and writes it as *original_structure_smiles.tsv*.
- If no structural field, takes the chemical name of the metabolite (name) and writes it as *original_structure_nominal.tsv*
Takes all columns and write them as *original_table.tsv*

### 02_translate_bio (script)
Takes *original_organism.tsv* in *outputs/tables/0_original* together with *common_names_list* and *tcm_names_list* in *00_miscellanous* as input and generates *translated_organism.tsv* in *outputs/tables/1_translated/gnfinder* as output. 
It **replaces common and TCM names with their scientific translation**. It replaces it with the genus only. Example: For _apple_, only _Malus_ will be imputed, not _Malus domestica_. It also removes characters avoiding good recognition of scientific names by GNFinder. 

### 02_chemo_translate_nominal (script)
Takes *original_structure_name.tsv* in *outputs/tables/0_original* as input and generates *translated_structure_name.tsv* in *outputs/tables/1_translated* as output. 
It translates all **names** **to InChI**. 

### 02_chemo_translate_smiles (script)
Takes *original_structure_smiles.tsv* in *outputs/tables/0_original* as input and generates *translated_structure_smiles.tsv* in *outputs/tables/1_translated* as output. 
It translates all **SMILES** **to InChI**. 

### 03_compile_DB_translated (script)
Takes all *translated tables* in *outputs/tables/1_translated* together *with initial InChIs* as input and generates outputs in *outputs/tables/1_translated* as output.
- Generates n *lists of 10'000 unique translated biological entries* for GNFINDER. (in *outputs/tables/1_translated/gnfinder*)
- Generates a list of unique InChI's (*translated_structure_rdkit.tsv* in *outputs/tables/1_translated/rdkit*)
- Generates a table containing original bio/chemo inputs and corresponding translated outputs (*translated_table.tsv* in *outputs/tables/1_translated/table*)

### 04_sanitize_and_hierarchize_bio (folder)
Takes the n *lists of 10'000 unique translated biological entries* in *outputs/tables/1_translated/gnfinder* as input and generates outputs in *outputs/tables/2_sanitized/gnfinder/json* as output.
It **retrieves scientific names from texts** and **associate corresponding biological taxonomy** to the found names.

### 04_sanitize_chemo (folder)
Takes *translated_structure_rdkit.tsv* in *outputs/tables/1_translated/rdkit* taken as input and generates *sanitized_structure.tsv* in *outputs/tables/2_sanitized* as output.
It **sanitizes (maybe define) structures** (eg. removing counterions, checking valence, neutralizing charges, etc.)

### 05_compile_bio_sanitized (script)
Takes all files in *outputs/tables/1_translated/gnfinder* together with the files in *outputs/tables/2_sanitized/gnfinder/json* as input and generates outputs in *outputs/tables/2_sanitized/gnfinder/tsv* as output.

### 06_fill_bio_sanitized (script)
Takes all files in *outputs/tables/2_sanitized/gnfinder/tsv* as input and generates *sanitized_organism.tsv* in *outputs/tables/2_sanitized* as output. 
It identifies entries where no scientific name with related taxonomy has been found.
- If a scientific name (in form of a canonical name) has been found but without taxonomy, it takes it and performs taxonomy search again in R (with _taxize_ package). 
- If no scientific name has been found, it removes most commonly occurring strings in biological source field (e.g.: "_Isolated from_", "_Component of_", etc. (list described in _XXX_ function)) and performs the search again on the remaining field.
- If still no taxonomy is found, it performs the search again, on the first remaining string only.

### 07_compile_DB_sanitized (script)
Takes *sanitized_organism.tsv* and *sanitized_structure.tsv* in *outputs/tables/2_sanitized/* together with the *translated_table.tsv* as input and generates *sanitized_table.tsv* in *outputs/tables/2_sanitized* as output. 

### 08_curate_bio (script)
Takes *sanitized_organism.tsv* and in *outputs/tables/2_sanitized/* as input and generates *curated_organism.tsv* in *outputs/tables/3_curated* together with *curated_organisms_different_species.tsv* in *outputs/tables* as output. 
It contains two different curations: 
- Taxonomy curation in order to avoid discordant taxonomies among the available taxonomical DBs. It is performed in two steps: first an automatic one and then a manual one:
	- **taxo_cleaning_auto** : It first sorts the taxonomical DBs in order to have first *Catalogue of Life* and second *NCBI* results. It then groups entries by species and kingdom (to avoid ambiguous genera (**maybe explain**) to be mixed). Following this step, only one entry is kept, carrying as much information as possible. **give example** This step is repeated for each taxonomical level up until phylum.
	- **taxo_cleaning_manual** : For entries that could not be cleaned automatically, manual curation is performed. All manual curation steps are described in the function. **give example** (**and maybe explain more**)
- Organism curation is also performed in order to remove aberrant entries generated by scientific name recognition and having a corresponding taxon in taxonomical DBs. **give example**

### 08_curate_chemo (script)
**TO DO**
...

### 09_classyfire (script)
**TO DO**
...

### 10_hierarchize_chemo (script)
**TO DO**
...

### 11_compile_DB_curated (script)
**TO DO**
...

### 12_add_metadata (folder)
**TO DO**
...

### 13_compile_unique_pairs_and_stats (script)
**TO DO**
...

### 14_draw_figures (script)
**TO DO**
...



### XX_minimal_working_example_compileR (script)
**TO DO**
...

### functions (functions)
**TO DO**
...

### Z_old_to_keep (folder)
**TO DO**
...

### outputs (folder)
**TO DO**
...


## Explanations

Add additional notes 

## Contributing

Please read [CONTRIBUTING.md](CONTRIBUTING.md) for details on our code of conduct, and the process for submitting pull requests to us.

## Versioning

Should we include versioning?

## Authors

* **Adriano Rutz** - *Initial work* - [Adriano.Rutz](https://gitlab.unige.ch/Adriano.Rutz)
* **Pierre-Marie Allard** - *Investigator* - [Pierre-Marie.Allard](https://gitlab.unige.ch/Pierre-Marie.Allard)

See also the list of [contributors](https://gitlab.unige.ch/Adriano.Rutz/opennaturalproductsdb/-/project_members) who participated in this project.

## License

This project is licensed under the MIT License - see the [LICENSE.md](LICENSE.md) file for details

## Acknowledgments

* Hat tip to anyone whose code was used
* Inspiration
* etc.

